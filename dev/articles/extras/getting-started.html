<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started â€¢ workflows</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../tidyverse-2.css" rel="stylesheet">
<!--optional theme--><link href="../../tidymodels.css" rel="stylesheet">
<meta property="og:title" content="Getting Started">
<meta property="og:description" content="workflows">
<meta property="og:image" content="https://workflows.tidymodels.org/logo.png">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">workflows</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://tidymodels.org">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.2.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../articles/stages.html">Workflow Stages</a>
</li>
<li>
  <a href="../../articles/extras/getting-started.html">Getting Started</a>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/workflows/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="getting-started_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/workflows/blob/master/vignettes/extras/getting-started.Rmd"><code>vignettes/extras/getting-started.Rmd</code></a></small>
      <div class="hidden name"><code>getting-started.Rmd</code></div>

    </div>

    
    
<p>This is an example of a fairly realistic interactive data analysis project to demonstrate how workflows can be used.</p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In this <code>bivariate</code> data set, there are two predictors that can be used to differentiate two classes in the outcome.</p>
<p>There are three partitions of the original data: training (n = 1009), validation (n = 300), and testing (n = 710). We will work with the training set the most, use the validation set to compare models during the development process, and then use the test set once we think that we have a good algorithm for making predictions.</p>
<p>Here is the training set:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/tidymodels/workflows">workflows</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://modeldata.tidymodels.org">modeldata</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"bivariate"</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">bivariate_train</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">A</span>, y = <span class="kw">B</span>, col = <span class="kw">Class</span>)) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(alpha = <span class="fl">.3</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>(ratio = <span class="fl">20</span>)
</pre></div>
<p><img src="getting-started_files/figure-html/plot-data-1.png" width="768"></p>
<p>Both predictors have positive values and their distributions are right-skewed. There seems to be a separation of the classes, but only when the variables are used together. For example, when the predictors are visualized individually, there is little evidence in separation of the classes.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://tidyr.tidyverse.org">tidyr</a></span>)

<span class="kw">bivariate_train</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(cols = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">A</span>, <span class="kw">B</span>), names_to = <span class="st">"predictor"</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">Class</span>, y = <span class="kw">value</span>)) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="kw">predictor</span>, scales = <span class="st">"free_y"</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span>()
</pre></div>
<p><img src="getting-started_files/figure-html/plot-marginals-1.png" width="768"></p>
<p>In the first plot above, the separation appears to happen linearly, and a straight, diagonal boundary might do well. We could use <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> directly to create a logistic regression, but we will use the <code>tidymodels</code> infrastructure and start by making a <code>parsnip</code> model object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://parsnip.tidymodels.org">parsnip</a></span>)

<span class="kw">logit_mod</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/logistic_reg.html">logistic_reg</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span>(<span class="st">"glm"</span>)
</pre></div>
<p>This data analysis will involve looking at a few different approaches of representing the two predictors so that we have a high-quality model. Weâ€™ll walk though the thought process of this analysis as we go. This will emulate how most data analysis projects happen: an initial approach is taken and then potential steps are attempted to make improvements. There is no pre-defined blueprint to this process and the R4DS diagram summarizes the process nicely.</p>
<p>Since we are going to try different combinations of feature engineering and models, <code>workflows</code> are really useful since you can have one object that contains all of these operations. It helps organize your work instead of having different objects in your workspace that, at some point, have been used in pairs.</p>
</div>
<div id="a-first-set-of-models" class="section level2">
<h2 class="hasAnchor">
<a href="#a-first-set-of-models" class="anchor"></a>A first set of models</h2>
<p>The obvious place to start is by adding both predictors as-is into the model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># Create a workflow with just the model. We will add to this as we go. </span>
<span class="kw">glm_workflow</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../../reference/workflow.html">workflow</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/add_model.html">add_model</a></span>(<span class="kw">logit_mod</span>)

<span class="kw">simple_glm</span> <span class="op">&lt;-</span>
  <span class="kw">glm_workflow</span> <span class="op">%&gt;%</span>
  <span class="co"># Add both predictors in</span>
  <span class="fu"><a href="../../reference/add_formula.html">add_formula</a></span>(<span class="kw">Class</span> <span class="op">~</span> <span class="kw">.</span>) <span class="op">%&gt;%</span>
  <span class="co"># Fit the model:</span>
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>(data = <span class="kw">bivariate_train</span>)
</pre></div>
<p>To evaluate this model, the ROC curve will be computed along with its corresponding AUC.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/tidymodels/yardstick">yardstick</a></span>)
<span class="co">#&gt; For binary classification, the first factor level is assumed to be the event.</span>
<span class="co">#&gt; Set the global option `yardstick.event_first` to `FALSE` to change this.</span>

<span class="kw">simple_glm_probs</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">simple_glm</span>, <span class="kw">bivariate_val</span>, type = <span class="st">"prob"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">bivariate_val</span>)

<span class="kw">simple_glm_roc</span> <span class="op">&lt;-</span> 
  <span class="kw">simple_glm_probs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_curve.html">roc_curve</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)

<span class="kw">simple_glm_probs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_auc.html">roc_auc</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)
<span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;   .metric .estimator .estimate</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 roc_auc binary         0.773</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="kw">simple_glm_roc</span>)
</pre></div>
<p><img src="getting-started_files/figure-html/simple-roc-1.png" width="768"></p>
<p>This seems reasonable. One potential issue is that the two predictors have a high degree of correlation 0.848, and this might cause some instability in the model.</p>
<p>Since there are two correlated predictors with skewed distributions and strictly positive values, it might be intuitive to use their ratio instead of the pair. Weâ€™ll try that next by recycling the initial workflow and just adding a different formula:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">ratio_glm</span> <span class="op">&lt;-</span>
  <span class="kw">glm_workflow</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/add_formula.html">add_formula</a></span>(<span class="kw">Class</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="kw">A</span><span class="op">/</span><span class="kw">B</span>)) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>(data = <span class="kw">bivariate_train</span>)

<span class="kw">ratio_glm_probs</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">ratio_glm</span>, <span class="kw">bivariate_val</span>, type = <span class="st">"prob"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">bivariate_val</span>)

<span class="kw">ratio_glm_roc</span> <span class="op">&lt;-</span> 
  <span class="kw">ratio_glm_probs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_curve.html">roc_curve</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)

<span class="kw">ratio_glm_probs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_auc.html">roc_auc</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)
<span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;   .metric .estimator .estimate</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 roc_auc binary         0.765</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="kw">simple_glm_roc</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span>(
    data = <span class="kw">ratio_glm_roc</span>, 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="fl">1</span> <span class="op">-</span> <span class="kw">specificity</span>, y = <span class="kw">sensitivity</span>), 
    col = <span class="st">"#FDE725FF"</span>
  )
</pre></div>
<p><img src="getting-started_files/figure-html/ratios-1.png" width="768"></p>
<p>The original analysis shows a slight edge, but the two models are probably within the experimental noise of one another.</p>
</div>
<div id="more-complex-feature-engineering" class="section level2">
<h2 class="hasAnchor">
<a href="#more-complex-feature-engineering" class="anchor"></a>More complex feature engineering</h2>
<p>Instead of combining the two predictors, would it help the model if we were to resolve the skewness of the variables? To test this theory, one option would be to use the Box-Cox transformation on each predictor individually to see if it recommends a nonlinear transformation. The transformation can encode a variety of different functions including the log transform, square root, inverse, and fractional transformations in-between these.</p>
<p>This cannot be easily done via the formula interface, so a recipe is used. A recipe is a list of sequential data processing steps that are conducted before the data are used in a model. For example, to use the Box-Cox method, a simple recipe would be:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/tidymodels/recipes">recipes</a></span>)

<span class="kw">trans_recipe</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span>(<span class="kw">Class</span> <span class="op">~</span> <span class="kw">.</span>, data = <span class="kw">bivariate_train</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_BoxCox.html">step_BoxCox</a></span>(<span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>())
</pre></div>
<p>Creating the recipe only makes an object with the instructions; it does not carry out the instructions (e.g.Â estimate the transformation parameter). The general process to use a recipe with a model would be to:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># estimate the required parameters via `prep()`:</span>
<span class="kw">updated_rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span>(<span class="kw">trans_recipe</span>)
</pre></div>
<p>Now we have all of the ingredients to execute the data pre-processing. To get the pre-processed version of the training set, <code><a href="https://recipes.tidymodels.org/reference/juice.html">juice()</a></code> can be used to return a data frame with the transformed predictors, and these can be passed on to <code><a href="https://rdrr.io/pkg/generics/man/fit.html">fit()</a></code>.</p>
<p><code>workflows</code> eliminates the multiple steps between creating the recipe and getting the fitted model. Internally, it prepares the recipe so that you donâ€™t have to:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">trans_glm</span> <span class="op">&lt;-</span>
  <span class="kw">glm_workflow</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/add_recipe.html">add_recipe</a></span>(<span class="kw">trans_recipe</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>(data = <span class="kw">bivariate_train</span>)

<span class="kw">trans_glm_probs</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">trans_glm</span>, <span class="kw">bivariate_val</span>, type = <span class="st">"prob"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">bivariate_val</span>)

<span class="kw">trans_glm_roc</span> <span class="op">&lt;-</span> 
  <span class="kw">trans_glm_probs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_curve.html">roc_curve</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)

<span class="kw">trans_glm_probs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_auc.html">roc_auc</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)
<span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;   .metric .estimator .estimate</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 roc_auc binary         0.815</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="kw">simple_glm_roc</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span>(
    data = <span class="kw">ratio_glm_roc</span>, 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="fl">1</span> <span class="op">-</span> <span class="kw">specificity</span>, y = <span class="kw">sensitivity</span>), 
    col = <span class="st">"#FDE725FF"</span>
  ) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span>(
    data = <span class="kw">trans_glm_roc</span>, 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="fl">1</span> <span class="op">-</span> <span class="kw">specificity</span>, y = <span class="kw">sensitivity</span>), 
    col = <span class="st">"#21908CFF"</span>
  )
</pre></div>
<p><img src="getting-started_files/figure-html/rec-trans-1.png" width="768"></p>
<p>That is a potential, if not slight, improvement.</p>
<p>The Box-Cox procedure recommended transformations that are pretty close to the inverse.</p>
<p>The model above creates a class boundary for these data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">bivariate_train</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="fl">1</span><span class="op">/</span><span class="kw">A</span>, y = <span class="fl">1</span><span class="op">/</span><span class="kw">B</span>, col = <span class="kw">Class</span>)) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(alpha = <span class="fl">.3</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>(ratio = <span class="fl">1</span><span class="op">/</span><span class="fl">12</span>)
</pre></div>
<p><img src="getting-started_files/figure-html/plot-inverse-1.png" width="768"></p>
<p>The correlation between these is about the same as in the original data. It might help the model to de-correlate them, and the standard technique for this is principal component analysis. A recipe step can be added that will conduct PCA and return the score values. The scores, instead of the original predictors, can then be used in the model. PCA chases variability, so it is important to normalize the two predictors so that they have the same units. Traditionally, each column could be centered and scaled. For this reason, a step is used prior to PCA that normalizes the two predictors.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">pca_recipe</span> <span class="op">&lt;-</span> 
  <span class="kw">trans_recipe</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html">step_normalize</a></span>(<span class="kw">A</span>, <span class="kw">B</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_pca.html">step_pca</a></span>(<span class="kw">A</span>, <span class="kw">B</span>, num_comp = <span class="fl">2</span>)

<span class="kw">pca_glm</span> <span class="op">&lt;-</span>
  <span class="kw">glm_workflow</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/add_recipe.html">add_recipe</a></span>(<span class="kw">pca_recipe</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>(data = <span class="kw">bivariate_train</span>)

<span class="kw">pca_glm_probs</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">pca_glm</span>, <span class="kw">bivariate_val</span>, type = <span class="st">"prob"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">bivariate_val</span>)

<span class="kw">pca_glm_roc</span> <span class="op">&lt;-</span> 
  <span class="kw">pca_glm_probs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_curve.html">roc_curve</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)

<span class="kw">pca_glm_probs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_auc.html">roc_auc</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)
<span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;   .metric .estimator .estimate</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 roc_auc binary         0.815</span>
</pre></div>
<p>These results are almost identical to the transformed model.</p>
</div>
<div id="a-different-model" class="section level2">
<h2 class="hasAnchor">
<a href="#a-different-model" class="anchor"></a>A different model</h2>
<p>Letâ€™s try a flexible discriminant analysis model (with MARS functions) using the <code>discrim</code> package. Would a different model work better?</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/tidymodels/discrim">discrim</a></span>)

<span class="kw">discrim_mod</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/discrim/man/discrim_flexible.html">discrim_flexible</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span>(<span class="st">"earth"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html">set_mode</a></span>(<span class="st">"classification"</span>) 

<span class="kw">discrim_wflow</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../../reference/workflow.html">workflow</a></span>() <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/add_recipe.html">add_recipe</a></span>(<span class="kw">trans_recipe</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/add_model.html">add_model</a></span>(<span class="kw">discrim_mod</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/generics/man/fit.html">fit</a></span>(data = <span class="kw">bivariate_train</span>)

<span class="kw">discrim_probs</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">discrim_wflow</span>, <span class="kw">bivariate_val</span>, type = <span class="st">"prob"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">bivariate_val</span>)

<span class="kw">discrim_roc</span> <span class="op">&lt;-</span> 
  <span class="kw">discrim_probs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_curve.html">roc_curve</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)

<span class="kw">discrim_probs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_auc.html">roc_auc</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)
<span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;   .metric .estimator .estimate</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 roc_auc binary         0.813</span>
</pre></div>
<p>Not this one, at least.</p>
</div>
<div id="the-test-set" class="section level2">
<h2 class="hasAnchor">
<a href="#the-test-set" class="anchor"></a>The test set</h2>
<p>Based on these results, the model with the logistic regression model with inverse terms is probably our best bet. Using the test set:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">test_probs</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">trans_glm</span>, <span class="kw">bivariate_test</span>, type = <span class="st">"prob"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw">bivariate_test</span>)

<span class="kw">test_roc</span> <span class="op">&lt;-</span> 
  <span class="kw">test_probs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_curve.html">roc_curve</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)

<span class="co"># A little more optimistic than the validation set</span>
<span class="kw">test_probs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/roc_auc.html">roc_auc</a></span>(<span class="kw">Class</span>, <span class="kw">.pred_One</span>)
<span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;   .metric .estimator .estimate</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 roc_auc binary         0.862</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="kw">simple_glm_roc</span>) 
</pre></div>
<p><img src="getting-started_files/figure-html/test-set-1.png" width="768"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p><code>workflows</code> is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Davis Vaughan.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
